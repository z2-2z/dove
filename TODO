performance improvements for renderer
new version
